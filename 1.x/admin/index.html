
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Health Record Ingestion Service">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>Administration - HRI Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/custom_style.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hri-administration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="HRI Documentation" class="md-header__button md-logo" aria-label="HRI Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HRI Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Administration
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Alvearie/HRI/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="HRI Documentation" class="md-nav__button md-logo" aria-label="HRI Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    HRI Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Alvearie/HRI/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../processflow/" class="md-nav__link">
        Processing Flows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../apispec/" class="md-nav__link">
        API Specification
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../multitenancy/" class="md-nav__link">
        Multi-Tenancy
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Administration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Administration
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#managing-tenants" class="md-nav__link">
    Managing Tenants
  </a>
  
    <nav class="md-nav" aria-label="Managing Tenants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-tenant" class="md-nav__link">
    Create Tenant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-tenants" class="md-nav__link">
    Get Tenants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-tenant" class="md-nav__link">
    Get Tenant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-tenant" class="md-nav__link">
    Delete Tenant
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onboarding-new-data-integrators" class="md-nav__link">
    Onboarding New Data Integrators
  </a>
  
    <nav class="md-nav" aria-label="Onboarding New Data Integrators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#topic-naming-conventions" class="md-nav__link">
    Topic Naming Conventions:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topic-sizing-recommendations" class="md-nav__link">
    Topic Sizing Recommendations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manually-through-the-event-streams-ui" class="md-nav__link">
    Manually through the Event Streams UI
  </a>
  
    <nav class="md-nav" aria-label="Manually through the Event Streams UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-new-topic" class="md-nav__link">
    Create the new Topic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-management-api-stream-endpoints" class="md-nav__link">
    Using the Management API stream endpoints
  </a>
  
    <nav class="md-nav" aria-label="Using the Management API stream endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-stream" class="md-nav__link">
    Create Stream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-streams" class="md-nav__link">
    Get Streams
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-stream" class="md-nav__link">
    Delete Stream
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-service-credentials-for-kafka-permissions" class="md-nav__link">
    Creating Service Credentials for Kafka Permissions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hri-management-user-authorization" class="md-nav__link">
    HRI Management User Authorization
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../auth/" class="md-nav__link">
        Authorization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../monitorlog/" class="md-nav__link">
        Monitoring & Logging
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../releases/" class="md-nav__link">
        Releases
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        Glossary of Terms
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#managing-tenants" class="md-nav__link">
    Managing Tenants
  </a>
  
    <nav class="md-nav" aria-label="Managing Tenants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-tenant" class="md-nav__link">
    Create Tenant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-tenants" class="md-nav__link">
    Get Tenants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-tenant" class="md-nav__link">
    Get Tenant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-tenant" class="md-nav__link">
    Delete Tenant
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onboarding-new-data-integrators" class="md-nav__link">
    Onboarding New Data Integrators
  </a>
  
    <nav class="md-nav" aria-label="Onboarding New Data Integrators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#topic-naming-conventions" class="md-nav__link">
    Topic Naming Conventions:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topic-sizing-recommendations" class="md-nav__link">
    Topic Sizing Recommendations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manually-through-the-event-streams-ui" class="md-nav__link">
    Manually through the Event Streams UI
  </a>
  
    <nav class="md-nav" aria-label="Manually through the Event Streams UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-new-topic" class="md-nav__link">
    Create the new Topic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-management-api-stream-endpoints" class="md-nav__link">
    Using the Management API stream endpoints
  </a>
  
    <nav class="md-nav" aria-label="Using the Management API stream endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-stream" class="md-nav__link">
    Create Stream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-streams" class="md-nav__link">
    Get Streams
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-stream" class="md-nav__link">
    Delete Stream
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-service-credentials-for-kafka-permissions" class="md-nav__link">
    Creating Service Credentials for Kafka Permissions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hri-management-user-authorization" class="md-nav__link">
    HRI Management User Authorization
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/Alvearie/HRI/edit/master/docs/admin.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="hri-administration">HRI Administration<a class="headerlink" href="#hri-administration" title="Permanent link">&para;</a></h1>
<p>HRI Administration tasks include:</p>
<ol>
<li><a href="#managing-tenants">Managing Tenants</a></li>
<li><a href="#onboarding-new-data-integrators">Onboarding Data Integrators</a><ol>
<li><a href="#manually-through-the-event-streams-ui">Manually through the Event Streams UI</a></li>
<li><a href="#using-the-management-api-stream-endpoints">Using the Management API Stream Endpoints</a></li>
</ol>
</li>
<li><a href="#hri-management-user-authorization">HRI Management User Authorization</a></li>
</ol>
<h2 id="managing-tenants">Managing Tenants<a class="headerlink" href="#managing-tenants" title="Permanent link">&para;</a></h2>
<p>Every <a href="../glossary/#tenant">Tenant</a> has a separate index in <a href="../glossary/#elasticsearch">Elasticsearch</a>. Indexes are named <code>&lt;tenantId&gt;-batches</code>. For example, if the tenant ID is <code>24</code>, the new index name will be <code>24-batches</code>. Some solutions may include a <code>tenant</code> prefix, e.g. <code>tenant24-batches</code>. The tenant ID may contain any lowercase alphanumeric strings, <code>-</code>, and <code>_</code>. Whatever pattern you use, this will determine the tenant ID path parameter required in most of the Management API <a href="../apispec/">endpoints</a>, and will need to be communicated to Data Integrators for that tenant. If you are using an existing deployment, check with team managing the instance on naming conventions.</p>
<p>There are four Management API endpoints that support Tenant management in Elasticsearch for HRI: Create, Get (all tenants), Get (specific tenant) and Delete. Please note that all four of these endpoints require IAM authentication - you will need to pass in an IAM Bearer token as part of the authorization header in the requests.</p>
<h4 id="create-tenant">Create Tenant<a class="headerlink" href="#create-tenant" title="Permanent link">&para;</a></h4>
<p>Use the Management API Create Tenant endpoint to create new Tenants. This will create a new index for the Tenant in Elasticsearch. The <code>Create</code> Tenant endpoint takes in one path parameter <code>tenantId</code>, which may only contain lowercase alphanumeric characters, <code>-</code>, and <code>_</code>. For example, for the <code>tenantId</code> &ldquo;24&rdquo; you would use the following curl command:</p>
<div class="codehilite"><pre><span></span><code>curl -X POST \
  &lt;hri_base_url&gt;/tenants/24 \
  -H &#39;Accept: application/json&#39; \
  -H &#39;Authorization: Bearer &lt;token&gt;&#39; \
  -H &#39;Content-Type: application/json&#39;
</code></pre></div>

<h4 id="get-tenants">Get Tenants<a class="headerlink" href="#get-tenants" title="Permanent link">&para;</a></h4>
<p>The <code>Get</code> endpoint takes in no parameters and returns a list of all tenantIds that have an Elastic index. Assuming the above Create was run, then the following cURL command (HTTP/Get operation) would return a list containing the single tenantId &ldquo;24&rdquo;:</p>
<div class="codehilite"><pre><span></span><code>curl -X GET \
  &lt;hri_base_url&gt;/tenants \
  -H &#39;Accept: application/json&#39; \
  -H &#39;Authorization: Bearer &lt;token&gt;&#39; \
  -H &#39;Content-Type: application/json&#39;
</code></pre></div>

<h4 id="get-tenant">Get Tenant<a class="headerlink" href="#get-tenant" title="Permanent link">&para;</a></h4>
<p>The <code>GetTenant</code> endpoint can also take in a <code>tenantId</code> and will return a list of information on the associated index. Assuming the above Create was run, then the following cURL command (HTTP/Get operation) would return a list of information on the index for &ldquo;24&rdquo;:</p>
<div class="codehilite"><pre><span></span><code>curl -X GET \
  &lt;hri_base_url&gt;/tenants/24 \
  -H &#39;Accept: application/json&#39; \
  -H &#39;Authorization: Bearer &lt;token&gt;&#39; \
  -H &#39;Content-Type: application/json&#39;
</code></pre></div>

<h4 id="delete-tenant">Delete Tenant<a class="headerlink" href="#delete-tenant" title="Permanent link">&para;</a></h4>
<p>Like <code>Create</code>, the <code>Delete</code> Tenant endpoint takes in <code>tenantId</code>. The following curl command will delete the elastic index for <code>24</code>:</p>
<div class="codehilite"><pre><span></span><code>curl -X DELETE \
  &lt;hri_base_url&gt;/tenants/24 \
  -H &#39;Accept: application/json&#39; \
  -H &#39;Authorization: Bearer &lt;token&gt;&#39; \
  -H &#39;Content-Type: application/json&#39;
</code></pre></div>

<h2 id="onboarding-new-data-integrators">Onboarding New Data Integrators<a class="headerlink" href="#onboarding-new-data-integrators" title="Permanent link">&para;</a></h2>
<p>Every unique combination of Tenant and <a href="../glossary/#data-integrator">Data Integrator</a> must have a separate &lsquo;stream&rsquo;, path of data through the HRI, in order to satisfy HIPAA data isolation requirements. See <a href="../multitenancy/">Multi-tenancy</a> for more details. Every stream includes two topics, and they can be added manually through the Event Streams UI and API or automatically through the Management API.</p>
<h3 id="topic-naming-conventions">Topic Naming Conventions:<a class="headerlink" href="#topic-naming-conventions" title="Permanent link">&para;</a></h3>
<p>Please note that HRI uses the following naming conventions for topics:</p>
<ol>
<li><code>ingest.&lt;tenantId&gt;.&lt;dataIntegratorId&gt;[.metadataTag].in</code></li>
<li><code>ingest.&lt;tenantId&gt;.&lt;dataIntegratorId&gt;[.metadataTag].notification</code></li>
</ol>
<p>The <code>metadataTag</code> is an optional field that can be set to any user defined value. For example, with tenant id <code>24</code>, Data Integrator id <code>data-int-1</code>, and metadata tag <code>claims</code>, the topics would be:</p>
<ol>
<li><code>ingest.24.data-int-1.claims.in</code></li>
<li><code>ingest.24.data-int-1.claims.notification</code></li>
</ol>
<p>The tenant ID must be consistent with the Elasticsearch <a href="#managing-tenants">index tenant ID</a>. Only use lowercase alphanumeric characters, <code>-</code>, and <code>_</code>.</p>
<h3 id="topic-sizing-recommendations">Topic Sizing Recommendations<a class="headerlink" href="#topic-sizing-recommendations" title="Permanent link">&para;</a></h3>
<p>Topic sizing mainly consists of the number of partitions and the retention policy (time and amount of data), and mainly depends on three factors:</p>
<ul>
<li>the size of batches</li>
<li>the frequency of batches</li>
<li>the throughput of Data Consumers</li>
</ul>
<p>The number of partitions determines how many Data Consumer processes can read and process the data in parallel, with one process per partition. The retention policy determines how much data the topic will store before removing it due to time or size constraints. The throughput of Data Consumers is mainly dependent on what is done with the data after reading it. At a minimum, the Data Consumers must be faster than the long term rate of incoming data. Otherwise, data may be removed from the topic before it is consumed, resulting in data loss. For example, if a 10 GB batch is written by Data Integrators every 4 hours, the Data Consumers must have a process rate greater than 2.5 GBs per hour. Otherwise, they will continually fall behind and eventually not process some data before it is removed from the topic.</p>
<p>For initial sizing, estimate the peak data load size (could include multiple batches depending on your solution) and divide by 1 GB (compressed) to get the number of partitions. For example, if the peak data load is 10 GBs, then start with 10 partitions. Also set the retention size to 10 GBs. In production environments, the retention time is typically 3-7 days. With longer times, you may need to also increase the retention size.</p>
<p>As the frequency and size of data loads increase, the number of partitions and retention policy should also increase. As the throughput of Data Consumers increases, the number of partitions and retention policy should decrease.</p>
<p><strong>NOTE:</strong> if creating topics manually, only 1 partition is needed for the <code>*.notification</code> topic.</p>
<h3 id="manually-through-the-event-streams-ui">Manually through the Event Streams UI<a class="headerlink" href="#manually-through-the-event-streams-ui" title="Permanent link">&para;</a></h3>
<p>Create the required Kafka topics described above using the IBM Cloud Event Streams UI.</p>
<h4 id="create-the-new-topic">Create the new Topic<a class="headerlink" href="#create-the-new-topic" title="Permanent link">&para;</a></h4>
<p>To Create the new topics, in your IBM Cloud account navigate to your Event Streams service. Click on the <strong>Topics</strong> tab/link on the left of your screen. Next, click on the &ldquo;Create Topic&rdquo; button on the upper right-hand side of the screen:
<img alt="event-streams-list-topics" src="../images/event_streams_list_topics.png" /></p>
<p>Enter your topic name, as defined by the naming conventions above, the number of partitions, and the retention time. Note that you must toggle <strong>Show all available options</strong> to see the partition and retention policy options.
<img alt="create-topic-name" src="../images/create_topic.png" /></p>
<h3 id="using-the-management-api-stream-endpoints">Using the Management API stream endpoints<a class="headerlink" href="#using-the-management-api-stream-endpoints" title="Permanent link">&para;</a></h3>
<p>There are three Management API <code>Stream</code> endpoints: <code>Create</code>, <code>Get</code>, and <code>Delete</code>. Please note that all three of these endpoints require IAM authentication - you will need to pass in an IAM Bearer token as part of the authorization header in the requests.</p>
<p>In the case of <code>Create</code> and <code>Delete</code>, the IAM bearer token must be associated with a user who has Manager role permissions. For <code>Get</code>, the bearer token must be associated with a user who has at least Reader role permissions. See <a href="https://cloud.ibm.com/docs/EventStreams?topic=EventStreams-security#assign_access">Event Streams documentation</a> for details on permissions.</p>
<h4 id="create-stream">Create Stream<a class="headerlink" href="#create-stream" title="Permanent link">&para;</a></h4>
<p>Instead of manually creating the topics for the Tenant and Data Integrator pairing, you may choose to use the Management API Create Stream endpoint which will create the topics for you, and take into account if validation is enabled.</p>
<p>The <code>Create</code> Stream endpoint takes in two path parameters, <code>tenantId</code> and <code>streamId</code>, where <code>streamId</code> is made up of the Data Integrator ID and an optional qualifier, delimited by &lsquo;.&rsquo;. Both <code>tenantId</code> and <code>streamdId</code> may only contain lowercase alphanumeric characters, <code>-</code>, and <code>_</code>. <code>streamdId</code> may also contain one &lsquo;.&rsquo;. For example, for the <code>tenantId</code> &ldquo;tenant24&rdquo;, Data Integrator ID &ldquo;data-int-1&rdquo; and optional qualifier &ldquo;qualifier1&rdquo;, you could use the following curl command:</p>
<div class="codehilite"><pre><span></span><code>curl -X POST \
  &lt;hri_base_url&gt;/tenants/tenant24/streams/data-int-1.qualifier1 \
  -H &#39;Accept: application/json&#39; \
  -H &#39;Authorization: Bearer &lt;token&gt;&#39; \
  -H &#39;Content-Type: application/json&#39; \
  -d &#39;{
    &quot;numPartitions&quot;:1,
    &quot;retentionMs&quot;:86400000
  }&#39;
</code></pre></div>

<p>This will create the following topics:</p>
<ol>
<li><code>ingest.tenant24.data-int-1.qualifier1.in</code></li>
<li><code>ingest.tenant24.data-int-1.qualifier1.notification</code></li>
</ol>
<p><strong>Note:</strong></p>
<ul>
<li><code>numPartitions</code> and <code>retentionMs</code> topic configurations are required. There are other optional configurations that can also be passed in, see the <a href="../apispec/#streams">Stream Api Spec</a> for more details on these optional fields.</li>
<li>The <code>numPartitions</code> parameter is applied to the <code>*.in</code> topic, but the <code>*.notification</code> topic is set to 1.</li>
</ul>
<h4 id="get-streams">Get Streams<a class="headerlink" href="#get-streams" title="Permanent link">&para;</a></h4>
<p>The <code>Get</code> Streams endpoint takes in <code>tenantId</code> as a path parameter, and returns a list of all <code>streamId</code>&lsquo;s associated with that tenant. Assuming the above Create was run, then the following cURL command (HTTP/Get operation) would return a list containing the single streamId <code>data-int-1.qualifier1</code>:</p>
<div class="codehilite"><pre><span></span><code>curl -X GET \
  &lt;hri_base_url&gt;/tenants/tenant24/streams \
  -H &#39;Accept: application/json&#39; \
  -H &#39;Authorization: Bearer &lt;token&gt;&#39; \
  -H &#39;Content-Type: application/json&#39;
</code></pre></div>

<h4 id="delete-stream">Delete Stream<a class="headerlink" href="#delete-stream" title="Permanent link">&para;</a></h4>
<p>Like <code>Create</code>, the <code>Delete</code> Stream endpoint takes in two path parameters, <code>tenantId</code> and <code>streamId</code>. The following curl command will delete both the <code>ingest.tenant24.data-int-1.qualifier1.in</code> and <code>ingest.tenant24.data-int-1.qualifier1.notification</code> topics:</p>
<div class="codehilite"><pre><span></span><code>curl -X DELETE \
  &lt;hri_base_url&gt;/tenants/tenant24/streams/data-int-1.qualifier1 \
  -H &#39;Accept: application/json&#39; \
  -H &#39;Authorization: Bearer &lt;token&gt;&#39; \
  -H &#39;Content-Type: application/json&#39;
</code></pre></div>

<p>Note that HRI topic naming conventions require topics to start with the prefix &ldquo;ingest&rdquo; and end with the suffix &ldquo;in&rdquo; or &ldquo;notification&rdquo;. Both the Get and Delete endpoints will ignore any topics that don&rsquo;t follow this convention.</p>
<h3 id="creating-service-credentials-for-kafka-permissions">Creating Service Credentials for Kafka Permissions<a class="headerlink" href="#creating-service-credentials-for-kafka-permissions" title="Permanent link">&para;</a></h3>
<p>You have to create an Event Streams (Kafka) Service Credential for every client that will need to read from or write to one or more topics. Typically, every <a href="../glossary/#data-integrator">Data Integrator</a> and downstream <a href="../glossary/#data-consumer">Data Consumer</a> will need their own service credential. A service credential can be configured with IAM policies to just grant read and or write access to specific topics and consumer groups, so only one service credential is needed for each entity. You do <strong><em>not</em></strong> need to create a service credential for every topic.</p>
<p>Each service credential will initially have read or write access to all topics when created depending on whether the &lsquo;Reader&rsquo; or &lsquo;Writer&rsquo; role is selected respectively. But they can be configured with IAM policies to just grant read and or write access to specific topics and consumer groups regardless of which role is selected. It&rsquo;s good practice to select &lsquo;Writer&rsquo; for Data Integrators and &lsquo;Reader&rsquo; for downstream consumers.</p>
<p>To create a service credential, navigate to the Event Streams - Service Credentials page, and then click on the &ldquo;New Credential&rdquo; button on the right-hand side of your screen:
<img alt="event-streams-svc-creds" src="../images/event_streams_svc_creds.png" /></p>
<p>You can see in the Screenshot below an example of creating a Data Integrator service credential with the <em>Writer</em> role:<br />
<img alt="event-streams-new-cred" src="../images/event_streams_new_cred.png" /></p>
<p>Next, go to the IBM Cloud (Access) IAM Management tools to further restrict the service credential, by using the &ldquo;Manage&rdquo; drop-down menu at the top of your screen and choosing &lsquo;Access (IAM)&rsquo;. Then select &lsquo;Service IDs&rsquo; from the left menu.
<img alt="iam-manage" src="../images/iam_manage.png" /></p>
<p>Next select the Service ID for the credential you created. If you selected &lsquo;Auto Generate&rsquo; when creating the credential, it will have the same name, but be careful, because there can be multiple Service IDs with the same name. After selecting the Service ID, go to the &lsquo;Access policies&rsquo; tab. You should see one policy that is created by default, which allows read or write access to all topics. To restrict access to particular topics, you have to modify the existing policy and create several new ones. Below are rules about what policies to create for specific access.</p>
<ol>
<li>Create a policy with &lsquo;Reader&rsquo; service access and &lsquo;Resource type&rsquo; set to <code>cluster</code>. This will allow the Service ID to access the Event Streams brokers.</li>
<li>To allow read &amp; write permissions to a particular topic, create a policy with &lsquo;Reader&rsquo; and &lsquo;Writer&rsquo; service access, &lsquo;Resource type&rsquo; set to <code>topic</code>, and &lsquo;Resource ID&rsquo; set to the topic name.</li>
<li>To allow just read permissions to a particular topic, create a policy with &lsquo;Reader&rsquo; service access, &lsquo;Resource type&rsquo; set to <code>topic</code>, and &lsquo;Resource ID&rsquo; set to the topic name.</li>
<li>To allow subscribing to topics, the Service ID must be given permissions to create consumer groups. This is the standard way of consuming messages from Kafka. Create a policy with &lsquo;Reader&rsquo; service access, &lsquo;Resource type&rsquo; set to <code>group</code>, and &lsquo;Resource ID&rsquo; set to a unique ID for this client followed by a <code>*</code> using &lsquo;string matches&rsquo;, e.g. <code>data-int-1*</code>. This allows the client to only create consumer groups that begin with this ID when connecting to Event Streams. This also prevents clients who are reading from the same topics from interfering with each other.</li>
<li>To allow the use of <a href="https://www.confluent.io/blog/transactions-apache-kafka/">transactions</a> when writing to topics, create a policy with &lsquo;Writer&rsquo; service access and the &lsquo;Resource type&rsquo; set to <code>txnid</code>. We highly encourage the use of transactions for exactly-once write semantics. Duplicate messages will cause validation failures or problems for downstream consumers.</li>
</ol>
<p><strong>Note</strong>: policies support wildcards at the beginning and/or end of the &lsquo;Resource ID&rsquo; field when using the &lsquo;string matches&rsquo; qualifier. This enables <em>a single policy to allow access to multiple topics</em> when they share a common substring. For example, <code>ingest.24.data-int-1.*</code> could be used to allow access to the <code>ingest.24.data-int-1.in</code> and <code>ingest.24.data-int-1.notification</code> topics.</p>
<p>The Data Integrator will need read &amp; write access to the input topic, but only read access to the notification topic. This requires five IAM policies total. Below is an example.
<img alt="iam-manage" src="../images/iam_data_integrator_policies.png" /></p>
<p>A downstream consumer will need just read access to the input and notification topics. This requires three IAM policies total. Below is an example.
<img alt="iam-manage" src="../images/iam_consumer_policies.png" /></p>
<p>More detailed documentation on how to configure IAM policies for Event Streams <a href="https://cloud.ibm.com/docs/EventStreams?topic=EventStreams-security">can be found here</a>.</p>
<h2 id="hri-management-user-authorization">HRI Management User Authorization<a class="headerlink" href="#hri-management-user-authorization" title="Permanent link">&para;</a></h2>
<p>In your authorization service, create a new scope for this tenant and assign it to the Data Integrators and Consumers that need access. See <a href="../auth/">Authorization</a> for more details.</p>
<p>If you are using the IBM App ID Service, please see <a href="../auth/#adding-data-integrators-and-consumers">Authorization - &ldquo;Adding Data Integrators and Consumers&rdquo;</a>.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../deployment/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Deployment" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Deployment
            </div>
          </div>
        </a>
      
      
        
        <a href="../auth/" class="md-footer__link md-footer__link--next" aria-label="Next: Authorization" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Authorization
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 IBM Watson Health<br>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.bd0b6b67.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.467223ff.min.js"></script>
      
        <script src="../js/links_in_new_tabs.js"></script>
      
    
  </body>
</html>