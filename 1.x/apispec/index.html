
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Health Record Ingestion Service">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.0">
    
    
      
        <title>API Specification - HRI Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8b42a75e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/custom_style.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hri-api-specification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="HRI Documentation" class="md-header__button md-logo" aria-label="HRI Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HRI Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Specification
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/Alvearie/HRI/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="HRI Documentation" class="md-nav__button md-logo" aria-label="HRI Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    HRI Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/Alvearie/HRI/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../processflow/" class="md-nav__link">
        Processing Flows
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API Specification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API Specification
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#management-api-specification" class="md-nav__link">
    Management API Specification
  </a>
  
    <nav class="md-nav" aria-label="Management API Specification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hri-tenants-elasticsearch-indices" class="md-nav__link">
    HRI Tenants &amp; Elasticsearch Indices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batches" class="md-nav__link">
    Batches
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streams" class="md-nav__link">
    Streams
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apache-kafka" class="md-nav__link">
    Apache Kafka
  </a>
  
    <nav class="md-nav" aria-label="Apache Kafka">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#health-input-data-fhir-model" class="md-nav__link">
    Health Input Data - FHIR Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hri-specific-requirements" class="md-nav__link">
    HRI-Specific Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notification-messages" class="md-nav__link">
    Notification Messages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../multitenancy/" class="md-nav__link">
        Multi-Tenancy
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../admin/" class="md-nav__link">
        Administration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../auth/" class="md-nav__link">
        Authorization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../monitorlog/" class="md-nav__link">
        Monitoring & Logging
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../releases/" class="md-nav__link">
        Releases
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        Glossary of Terms
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#management-api-specification" class="md-nav__link">
    Management API Specification
  </a>
  
    <nav class="md-nav" aria-label="Management API Specification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hri-tenants-elasticsearch-indices" class="md-nav__link">
    HRI Tenants &amp; Elasticsearch Indices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batches" class="md-nav__link">
    Batches
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streams" class="md-nav__link">
    Streams
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apache-kafka" class="md-nav__link">
    Apache Kafka
  </a>
  
    <nav class="md-nav" aria-label="Apache Kafka">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#health-input-data-fhir-model" class="md-nav__link">
    Health Input Data - FHIR Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hri-specific-requirements" class="md-nav__link">
    HRI-Specific Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notification-messages" class="md-nav__link">
    Notification Messages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Alvearie/HRI/edit/master/docs/apispec.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="hri-api-specification">HRI API Specification<a class="headerlink" href="#hri-api-specification" title="Permanent link">&para;</a></h1>
<p>The HRI consists of two separate APIs: the Management API and Apache Kafka.</p>
<h2 id="management-api-specification">Management API Specification<a class="headerlink" href="#management-api-specification" title="Permanent link">&para;</a></h2>
<p>The Management API is defined using the OpenAPI 3.0 specification: <a href="https://github.com/Alvearie/hri-api-spec/blob/support-1.x/management-api/management.yml">management.yml</a>.
You can open the file directly or use a program such as <a href="https://swagger.io/tools/swagger-ui/download/">Swagger UI</a> to view it.</p>
<h3 id="hri-tenants-elasticsearch-indices">HRI Tenants &amp; Elasticsearch Indices<a class="headerlink" href="#hri-tenants-elasticsearch-indices" title="Permanent link">&para;</a></h3>
<p>HRI has been designed with a <a href="../multitenancy/">multi-tenant cloud architecture</a>. The API mainly contains methods for managing <a href="../glossary/#tenant">Tenants</a> like creating, getting, and deleting. Each of these calls takes in the tenantId. The ID is appended with the suffix -batches to create an index in Elasticsearch, where all the batch metadata is stored.</p>
<p>A <code>Get</code> call without a tenantId will return a list of all tenants. The <code>Get</code> call, when given a tenantId, will return information on the elastic index of a specific tenant. 
Below is a table of the fields returned by this call:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>health</td>
<td>health of the Elastic cluster</td>
</tr>
<tr>
<td>status</td>
<td>status of the index, can be open or closed</td>
</tr>
<tr>
<td>index</td>
<td>the name of the index, which will be the tenantId with <code>-batches</code> appended to it</td>
</tr>
<tr>
<td>uuid</td>
<td>universally unique identifier</td>
</tr>
<tr>
<td>pri</td>
<td>number of primary shards</td>
</tr>
<tr>
<td>rep</td>
<td>number of replicas</td>
</tr>
<tr>
<td>docs.count</td>
<td>number of batches documents stored in the index</td>
</tr>
<tr>
<td>docs.deleted</td>
<td>number of batches documents deleted from the index</td>
</tr>
<tr>
<td>store.size</td>
<td>store size taken by primary and replica shards</td>
</tr>
<tr>
<td>pri.store.size</td>
<td>store size taken only by primary shards</td>
</tr>
</tbody>
</table>
<h3 id="batches">Batches<a class="headerlink" href="#batches" title="Permanent link">&para;</a></h3>
<p>The API contains methods for managing <a href="../glossary/#batch">batches</a> like creating, getting, and updating. Below is a table of the fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>auto generated unique ID</td>
</tr>
<tr>
<td>name</td>
<td>name of the batch, provided by the Data Integrator</td>
</tr>
<tr>
<td>integratorId</td>
<td>unique ID of the Data Integrator that created this batch</td>
</tr>
<tr>
<td>topic</td>
<td>Event Streams (Kafka) topic that contains the data, provided by the Data Integrator</td>
</tr>
<tr>
<td>dataType</td>
<td>the type of data, provided by the Data Integrator</td>
</tr>
<tr>
<td>status</td>
<td>status of the batch: [ started, completed, terminated ]</td>
</tr>
<tr>
<td>startDate</td>
<td>the date and time the batch was started</td>
</tr>
<tr>
<td>endDate</td>
<td>the date and time the batch was completed or terminated</td>
</tr>
<tr>
<td>recordCount</td>
<td>the number of records in the batch, provided by the Data Integrator when completed</td>
</tr>
<tr>
<td>metadata</td>
<td>custom json value, optional</td>
</tr>
</tbody>
</table>
<p>Only the <code>name</code>, <code>topic</code>, and <code>dataType</code> fields are required when creating a batch.</p>
<p>The <code>metadata</code> field is optional and allows the Data Integrator to include any additional information about the batch that Data Consumers might request. This information will be included in all notification messages.</p>
<p>The <code>recordCount</code> is provided by the Data Integrator when the batch is completed, and thus not always present.</p>
<p>All other fields are generated by the API.  </p>
<h3 id="streams">Streams<a class="headerlink" href="#streams" title="Permanent link">&para;</a></h3>
<p>The API also contains methods for managing Event Streams topics like creating, getting, and deleting. Below is a table of the fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>stream ID, consisting of a data integrator and optional qualifier, delimited by &lsquo;.&rsquo;</td>
</tr>
<tr>
<td>numPartitions</td>
<td>the number of partitions on the topic</td>
</tr>
<tr>
<td>retentionMs</td>
<td>length of time in milliseconds before log segments are automatically discarded from a partition</td>
</tr>
<tr>
<td>retentionBytes</td>
<td>optional maximum size in bytes that a partition can grow before discarding log segments</td>
</tr>
<tr>
<td>cleanupPolicy</td>
<td>optional retention policy on old log segments</td>
</tr>
<tr>
<td>segmentMs</td>
<td>optional time in milliseconds after which Kafka will force the log to roll even if the segment file isn&rsquo;t full</td>
</tr>
<tr>
<td>segmentBytes</td>
<td>optional log segment file size in bytes</td>
</tr>
<tr>
<td>segmentIndexBytes</td>
<td>optional size in bytes of the index that maps offsets to file positions</td>
</tr>
</tbody>
</table>
<p>Only the <code>numPartitions</code> and <code>retentionMs</code> fields are required when creating a stream. The rest of the topic configurations (<code>retentionBytes</code>, <code>cleanupPolicy</code>, <code>segmentMs</code>, <code>segmentBytes</code>, and <code>segmentIndexBytes</code>) are optional. Below is a table of the default values and acceptable ranges for these optional fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Default value</th>
<th>Acceptable values/ranges</th>
</tr>
</thead>
<tbody>
<tr>
<td>retentionBytes</td>
<td>1073741824</td>
<td>[10485760..1073741824]</td>
</tr>
<tr>
<td>cleanupPolicy</td>
<td>delete</td>
<td>[ delete, compact ]</td>
</tr>
<tr>
<td>segmentMs</td>
<td>nil</td>
<td>[300000..2592000000]</td>
</tr>
<tr>
<td>segmentBytes</td>
<td>536870912</td>
<td>[10485760..536870912]</td>
</tr>
<tr>
<td>segmentIndexBytes</td>
<td>nil</td>
<td>[102400..104857600]</td>
</tr>
</tbody>
</table>
<p>If the <code>cleanupPolicy</code> field is set to compact, it will disable deletion based on time, ignoring the value set for the field <code>retentionMs</code>.</p>
<p>Event Streams is an IBM Cloud managed version of Apache Kafka. It uses standard Kafka libraries to read and write data to topics. See the IBM <a href="https://cloud.ibm.com/docs/EventStreams?topic=EventStreams-kafka_using#kafka_api_client">documentation</a> for details on connection parameters. </p>
<h2 id="apache-kafka">Apache Kafka<a class="headerlink" href="#apache-kafka" title="Permanent link">&para;</a></h2>
<p>Apache Kafka has its own API and clients are available for most languages. If using IBM Event Streams, see their <a href="https://cloud.ibm.com/docs/EventStreams?topic=EventStreams-kafka_using#kafka_api_client">documentation</a> for details on connection parameters. Below are the requirements on the records written to and read from Kafka.</p>
<h3 id="health-input-data-fhir-model">Health Input Data - FHIR Model<a class="headerlink" href="#health-input-data-fhir-model" title="Permanent link">&para;</a></h3>
<p>HRI <strong>does not</strong> impose any requirements on the format of the content of the Health (data) records written to Kafka, although Alvearie has selected FHIR as the preferred data model for all Health Data. See their <a href="https://github.com/Alvearie/alvearie-fhir-ig">FHIR implementation guide</a> for more details. <a href="../glossary/#data-integrator">Data Integrators</a> and <a href="../glossary/#data-consumer">Data Consumers</a> must work together to agree on the specifics of the input data such as format and frequency.</p>
<h3 id="hri-specific-requirements">HRI-Specific Requirements<a class="headerlink" href="#hri-specific-requirements" title="Permanent link">&para;</a></h3>
<p>The HRI <strong>does</strong> have the following requirements and recommendations:</p>
<ul>
<li>
<p>Batch ID Header - every record <strong>must</strong> have a header entry with the <a href="../glossary/#batch-id">batch ID</a> that uses the key <code>batchId</code>. Data Integrators may include any additional header values, which will get passed downstream to consumers.</p>
</li>
<li>
<p>Zstd Compression - use <code>zstd</code> compression when writing to Kafka by setting the <a href="https://kafka.apache.org/documentation/#compression.type">compression.type</a> producer configuration. Event Streams throttles network usage and limits Kafka messages to 1 MB. Using compression will help prevent an Event Streams bottleneck.</p>
</li>
<li>
<p>1 MB Message Limit - Event Streams limits messages to 1 MB. There is not a way to directly set the max message size after compression is applied in the Kafka producer. The <a href="https://kafka.apache.org/documentation/#message.max.bytes">message.max.bytes</a> producer configuration is applied before compression. The <a href="https://kafka.apache.org/documentation/#batch.size">batch.size</a> producer configuration can be set to limit the batching of records, but it can also affect performance. We recommend doing performance testing to determine appropriate values based on your data. For records over 1 MB compressed, there are two strategies:</p>
<ol>
<li>
<p>External References - for records that have large binary attachments like images or pdfs, you may provide a reference to the large resource that is included in the message, rather than the (large) resource itself. For example, you could put a COS Object URL, or some other external data store URL, and key into the message.</p>
</li>
<li>
<p>Splitting up Records - records can be split into smaller parts, sent through the HRI, and re-assembled by down stream consumers. </p>
</li>
</ol>
</li>
</ul>
<h3 id="notification-messages">Notification Messages<a class="headerlink" href="#notification-messages" title="Permanent link">&para;</a></h3>
<p>The notification messages are json-encoded batches. They match the schema returned by the Management API described above, which is also defined here: <a href="https://github.com/Alvearie/hri-api-spec/blob/support-1.x/notifications/batchNotification.json">batchNotification.json</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../processflow/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Processing Flows" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Processing Flows
            </div>
          </div>
        </a>
      
      
        
        <a href="../multitenancy/" class="md-footer__link md-footer__link--next" aria-label="Next: Multi-Tenancy" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Multi-Tenancy
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 IBM Watson Health<br>
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.f8263e09.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.4fc53ad4.min.js"></script>
      
        <script src="../js/links_in_new_tabs.js"></script>
      
    
  </body>
</html>